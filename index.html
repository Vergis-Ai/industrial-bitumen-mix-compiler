<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Advanced PMB Bitumen Mix Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
        }
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }
        input[type=checkbox] {
            width: 20px;
            height: 20px;
        }
    </style>
</head>
<body class="bg-slate-100 flex flex-col items-center justify-center p-6 min-h-screen">
    <div class="container bg-white rounded-3xl shadow-xl p-8 max-w-lg w-full md:max-w-3xl lg:max-w-4xl">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-4 md:text-4xl">Advanced PMB Bitumen Mix Calculator</h1>
        <p class="text-center text-gray-500 mb-8 max-w-md mx-auto">
            Enter the mix details to see updated mix qualities in real time. The total percentage for main components must be 100%.
        </p>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <div class="space-y-8">
                <div class="space-y-4">
                    <h2 class="text-xl font-semibold mb-4 text-gray-700 border-b pb-2">Main Components (Total must be 100%)</h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="flex flex-col gap-1">
                            <label for="c170Bitumen" class="text-sm font-medium text-gray-500">C170 Bitumen (%)</label>
                            <input type="number" id="c170Bitumen" min="0" max="100" step="0.01" value="70"
                                class="p-2 rounded-lg border-2 border-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors" />
                        </div>
                        <div class="flex flex-col gap-1">
                            <label for="sbs" class="text-sm font-medium text-gray-500">LG411 Radial (SBS) (%)</label>
                            <input type="number" id="sbs" min="0" max="100" step="0.01" value="15"
                                class="p-2 rounded-lg border-2 border-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors" />
                        </div>
                        <div class="flex flex-col gap-1">
                            <label for="ha32CombiningOil" class="text-sm font-medium text-gray-500">Ha32 Combining Oil (%)</label>
                            <input type="number" id="ha32CombiningOil" min="0" max="100" step="0.01" value="10"
                                class="p-2 rounded-lg border-2 border-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors" />
                        </div>
                        <div class="flex flex-col gap-1">
                            <label for="bitlinker" class="text-sm font-medium text-gray-500">Ravasol™ BITLINKER-S6F (%)</label>
                            <input type="number" id="bitlinker" min="0" max="100" step="0.01" value="5"
                                class="p-2 rounded-lg border-2 border-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors" />
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <h2 class="text-xl font-semibold mb-4 text-gray-700 border-b pb-2">Additives & Recycling</h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="flex items-center gap-2">
                            <input type="checkbox" id="carbonNanotubes" class="form-checkbox rounded text-indigo-600 focus:ring-indigo-500 h-5 w-5">
                            <label for="carbonNanotubes" class="text-gray-700">Carbon Nanotubes (0.5%)</label>
                        </div>
                        <div class="flex items-center gap-2">
                            <input type="checkbox" id="syntheticWax" class="form-checkbox rounded text-indigo-600 focus:ring-indigo-500 h-5 w-5">
                            <label for="syntheticWax" class="text-gray-700">Synthetic Wax (1%)</label>
                        </div>
                        <div class="flex flex-col gap-1">
                            <label for="rap" class="text-sm font-medium text-gray-500">RAP Content (%)</label>
                            <input type="number" id="rap" min="0" max="100" step="0.01" value="0"
                                class="p-2 rounded-lg border-2 border-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors" />
                        </div>
                        <div class="flex flex-col gap-1">
                            <label for="ras" class="text-sm font-medium text-gray-500">RAS Content (%)</label>
                            <input type="number" id="ras" min="0" max="100" step="0.01" value="0"
                                class="p-2 rounded-lg border-2 border-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors" />
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <h2 class="text-xl font-semibold mb-4 text-gray-700 border-b pb-2">SARA Composition (Total must be 100%)</h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="flex flex-col gap-1">
                            <label for="saturates" class="text-sm font-medium text-gray-500">Saturates (%)</label>
                            <input type="number" id="saturates" min="0" max="100" step="0.01" value="10"
                                class="p-2 rounded-lg border-2 border-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors" />
                        </div>
                        <div class="flex flex-col gap-1">
                            <label for="aromatics" class="text-sm font-medium text-gray-500">Aromatics (%)</label>
                            <input type="number" id="aromatics" min="0" max="100" step="0.01" value="50"
                                class="p-2 rounded-lg border-2 border-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors" />
                        </div>
                        <div class="flex flex-col gap-1">
                            <label for="resins" class="text-sm font-medium text-gray-500">Resins (%)</label>
                            <input type="number" id="resins" min="0" max="100" step="0.01" value="25"
                                class="p-2 rounded-lg border-2 border-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors" />
                        </div>
                        <div class="flex flex-col gap-1">
                            <label for="asphaltenes" class="text-sm font-medium text-gray-500">Asphaltenes (%)</label>
                            <input type="number" id="asphaltenes" min="0" max="100" step="0.01" value="15"
                                class="p-2 rounded-lg border-2 border-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors" />
                        </div>
                    </div>
                </div>
            </div>

            <div class="space-y-8">
                <h2 class="text-2xl font-bold text-gray-800 border-b pb-2">Mix Qualities</h2>

                <div class="bg-gray-100 p-4 rounded-xl shadow-inner min-h-[300px] flex items-center justify-center">
                    <canvas id="qualityChart" aria-label="Mix qualities chart" role="img"></canvas>
                </div>

                <div class="bg-indigo-50 rounded-lg p-6">
                    <ul class="grid grid-cols-2 gap-4 text-indigo-900 font-medium text-lg">
                        <li>Adhesion: <span id="adhesion" class="font-bold">--</span>%</li>
                        <li>Durability: <span id="durability" class="font-bold">--</span>%</li>
                        <li>Flexibility: <span id="flexibility" class="font-bold">--</span>%</li>
                        <li>Temp Resistance: <span id="tempResistance" class="font-bold">--</span>%</li>
                        <li>Aging Resistance: <span id="agingResistance" class="font-bold">--</span>%</li>
                        <li class="col-span-2">Elastic Recovery: <span id="elasticRecovery" class="font-bold">--</span>%</li>
                        <li class="col-span-2">Softening Point: <span id="softeningPoint" class="font-bold">--</span> °C</li>
                        <li class="col-span-2">Setting Time: <span id="settingTime" class="font-bold">--</span> mins</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="text-center mb-6 font-bold flex flex-col sm:flex-row items-center justify-center gap-6 p-4 border-t border-gray-200">
            <span id="totalPercentage" class="text-xl text-gray-800">Total Bitumen Mix: --%</span>
            <span id="remaining" class="text-xl flex items-center gap-2">
                <span class="text-gray-500">Remaining: --%</span>
                <span id="statusIcon" aria-hidden="true"></span>
                <span class="sr-only" id="statusText"></span>
            </span>
            <button id="resetButton" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-full transition-colors duration-300">
                Reset to Default
            </button>
        </div>
    </div>

    <script>
        (() => {
            // Helper to get DOM elements safely
            const getEl = id => document.getElementById(id) || null;

            // DOM references
            const inputs = {
                c170Bitumen: getEl('c170Bitumen'),
                sbs: getEl('sbs'),
                ha32CombiningOil: getEl('ha32CombiningOil'),
                bitlinker: getEl('bitlinker'),
                rap: getEl('rap'),
                ras: getEl('ras'),
                carbonNanotubes: getEl('carbonNanotubes'),
                syntheticWax: getEl('syntheticWax'),
                saturates: getEl('saturates'),
                aromatics: getEl('aromatics'),
                resins: getEl('resins'),
                asphaltenes: getEl('asphaltenes'),
            };

            const totalPercentageEl = getEl('totalPercentage');
            const remainingEl = getEl('remaining');
            const statusIconEl = getEl('statusIcon');
            const statusTextEl = getEl('statusText');
            const resetButton = getEl('resetButton');

            // Quality spans
            const qualityEls = {
                adhesion: getEl('adhesion'),
                durability: getEl('durability'),
                flexibility: getEl('flexibility'),
                tempResistance: getEl('tempResistance'),
                agingResistance: getEl('agingResistance'),
                elasticRecovery: getEl('elasticRecovery'),
                softeningPoint: getEl('softeningPoint'),
                settingTime: getEl('settingTime'),
            };

            // Default values
            const defaults = {
                c170Bitumen: 70,
                sbs: 15,
                ha32CombiningOil: 10,
                bitlinker: 5,
                rap: 0,
                ras: 0,
                carbonNanotubes: false,
                syntheticWax: false,
                saturates: 10,
                aromatics: 50,
                resins: 25,
                asphaltenes: 15,
            };

            // Polymer effect multipliers on properties (Base: C170/SBS blend)
            // Using SBS as the base effect since it is a primary mix component.
            const pEffect = {
                adhesion: 1.2, durability: 1.15, flexibility: 1.3, tempResistance: 1.1, agingResistance: 1.2, elasticRecovery: 70, softeningPoint: 70
            };

            // Additives effect boosts (as multipliers on current score)
            const additiveEffects = {
                carbonNanotubes: { adhesion: 1.05, durability: 1.10, flexibility: 1.03, tempResistance: 1.07, agingResistance: 1.10 },
                syntheticWax: { adhesion: 1.02, durability: 1.05, flexibility: 1.04, tempResistance: 1.03, agingResistance: 1.02 },
            };

            // Chart setup
            let chart = null;
            const ctxEl = getEl('qualityChart');

            if (ctxEl) {
                const ctx = ctxEl.getContext('2d');
                chart = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: ['Adhesion', 'Durability', 'Flexibility', 'Temp Resistance', 'Aging Resistance'],
                        datasets: [{
                            label: 'Mix Qualities (Score out of 100)',
                            data: [],
                            fill: true,
                            backgroundColor: 'rgba(99,102,241,0.2)',
                            borderColor: 'rgba(99,102,241,1)',
                            pointBackgroundColor: 'rgba(99,102,241,1)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgba(99,102,241,1)',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        elements: { line: { tension: 0 } },
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 100, // Scale to 100 for percentages
                                pointLabels: { font: { size: 14 } },
                                grid: { color: 'rgba(200, 200, 200, 0.2)' },
                                ticks: { stepSize: 20, callback: v => v + '%' }
                            }
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: ctx => `${ctx.label}: ${ctx.parsed.r.toFixed(1)}%`
                                }
                            }
                        },
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }

            // Helpers
            const clampRound = (num, min = 0, max = 100, decimals = 2) => Number(Math.min(Math.max(num, min), max).toFixed(decimals));
            const getInputValue = el => {
                if (!el) return 0;
                if (el.type === 'checkbox') return el.checked;
                return el.value === '' ? 0 : Number(el.value);
            };

            // Main calculation function
            const updateCalculations = () => {
                const componentInputs = [inputs.c170Bitumen, inputs.sbs, inputs.ha32CombiningOil, inputs.bitlinker];
                const saraInputs = [inputs.saturates, inputs.aromatics, inputs.resins, inputs.asphaltenes];

                const c170 = getInputValue(inputs.c170Bitumen);
                const sbs = getInputValue(inputs.sbs);
                const ha32 = getInputValue(inputs.ha32CombiningOil);
                const bitlinker = getInputValue(inputs.bitlinker);
                const rap = getInputValue(inputs.rap);
                const ras = getInputValue(inputs.ras);
                const hasCNT = getInputValue(inputs.carbonNanotubes);
                const hasWax = getInputValue(inputs.syntheticWax);
                const saturates = getInputValue(inputs.saturates);
                const aromatics = getInputValue(inputs.aromatics);
                const resins = getInputValue(inputs.resins);
                const asphaltenes = getInputValue(inputs.asphaltenes);

                // --- Mix Component Totals ---
                const totalComponents = clampRound(c170 + sbs + ha32 + bitlinker, 0, 999, 2);
                const remaining = clampRound(100 - totalComponents, -999, 100, 2);
                let isValid = Math.abs(totalComponents - 100) < 0.5;
                let statusMessage = isValid ? 'Valid' : 'Warning: Not 100%';

                if (totalPercentageEl) totalPercentageEl.textContent = `Total Bitumen Mix: ${totalComponents.toFixed(2)}%`;
                if (remainingEl) remainingEl.querySelector('span').textContent = `Remaining: ${remaining.toFixed(2)}%`;

                if (remainingEl) remainingEl.querySelector('span').classList.toggle('text-red-600', !isValid);

                // --- SARA Totals ---
                const totalSara = clampRound(saturates + aromatics + resins + asphaltenes, 0, 999, 2);
                const saraValid = Math.abs(totalSara - 100) < 0.5;

                if (!saraValid) {
                    statusIconEl.textContent = '⚠️';
                    statusMessage = 'SARA must total 100%';
                    isValid = false; // Override mix total validity if SARA is off
                    if (remainingEl) remainingEl.querySelector('span').classList.add('text-red-600');
                } else if (isValid) {
                    statusIconEl.textContent = '✅';
                    statusMessage = 'Valid';
                } else {
                    statusIconEl.textContent = '⚠️';
                    statusMessage = 'Warning: Not 100%';
                }
                
                if (statusTextEl) statusTextEl.textContent = statusMessage;


                // --- Quality Calculation (Scores out of 1.0 base, scaled to 100% for display/chart) ---

                // Base qualities (already SBS-modified)
                let adhesion = pEffect.adhesion;
                let durability = pEffect.durability;
                let flexibility = pEffect.flexibility;
                let tempResistance = pEffect.tempResistance;
                let agingResistance = pEffect.agingResistance;

                // Additive effects (multiplicative boost)
                if (hasCNT) {
                    adhesion *= additiveEffects.carbonNanotubes.adhesion;
                    durability *= additiveEffects.carbonNanotubes.durability;
                    flexibility *= additiveEffects.carbonNanotubes.flexibility;
                    tempResistance *= additiveEffects.carbonNanotubes.tempResistance;
                    agingResistance *= additiveEffects.carbonNanotubes.agingResistance;
                }
                if (hasWax) {
                    adhesion *= additiveEffects.syntheticWax.adhesion;
                    durability *= additiveEffects.syntheticWax.durability;
                    flexibility *= additiveEffects.syntheticWax.flexibility;
                    tempResistance *= additiveEffects.syntheticWax.tempResistance;
                    agingResistance *= additiveEffects.syntheticWax.agingResistance;
                }

                // SARA effects (Additive based on component % - arbitrary model)
                // Normalize SARA components for impact
                adhesion += (resins / 100) * 0.2;
                durability += (asphaltenes / 100) * 0.15;
                flexibility += (aromatics / 100) * 0.2;
                tempResistance += (asphaltenes / 100) * 0.1;
                agingResistance += (resins / 100) * 0.1 + (asphaltenes / 100) * 0.1;

                // Elastic Recovery, Softening Point, Setting Time
                let elasticRecovery = pEffect.elasticRecovery;
                let softeningPoint = pEffect.softeningPoint;
                let settingTime = 120; // Base setting time in minutes

                // Polymer/Recycling impact on other metrics
                elasticRecovery += (sbs * 0.5) - (rap * 0.1) - (ras * 0.05); // SBS improves, RAP/RAS reduce
                softeningPoint += (asphaltenes * 0.1) - (aromatics * 0.05); // Asphaltenes increase, Aromatics decrease

                // Bitlinker impact (arbitrary model)
                settingTime -= (bitlinker * 5); // Bitlinker reduces setting time

                // Final results (clamped to sensible ranges and multiplied by 100 for display percentage)
                const finalResults = {
                    adhesion: clampRound(adhesion * 100, 40, 100, 1),
                    durability: clampRound(durability * 100, 40, 100, 1),
                    flexibility: clampRound(flexibility * 100, 40, 100, 1),
                    tempResistance: clampRound(tempResistance * 100, 40, 100, 1),
                    agingResistance: clampRound(agingResistance * 100, 40, 100, 1),
                    elasticRecovery: clampRound(elasticRecovery, 30, 95, 1),
                    softeningPoint: clampRound(softeningPoint, 55, 90, 1),
                    settingTime: clampRound(settingTime, 10, 180, 0),
                };

                // Update DOM elements
                if (qualityEls.adhesion) qualityEls.adhesion.textContent = finalResults.adhesion.toFixed(1);
                if (qualityEls.durability) qualityEls.durability.textContent = finalResults.durability.toFixed(1);
                if (qualityEls.flexibility) qualityEls.flexibility.textContent = finalResults.flexibility.toFixed(1);
                if (qualityEls.tempResistance) qualityEls.tempResistance.textContent = finalResults.tempResistance.toFixed(1);
                if (qualityEls.agingResistance) qualityEls.agingResistance.textContent = finalResults.agingResistance.toFixed(1);
                if (qualityEls.elasticRecovery) qualityEls.elasticRecovery.textContent = finalResults.elasticRecovery.toFixed(1);
                if (qualityEls.softeningPoint) qualityEls.softeningPoint.textContent = finalResults.softeningPoint.toFixed(1);
                if (qualityEls.settingTime) qualityEls.settingTime.textContent = finalResults.settingTime.toFixed(0);

                // Update Chart
                if (chart) {
                    chart.data.datasets[0].data = [
                        finalResults.adhesion,
                        finalResults.durability,
                        finalResults.flexibility,
                        finalResults.tempResistance,
                        finalResults.agingResistance,
                        // Elastic Recovery is not a 'score out of 100' so we exclude it from the radar chart to maintain scale clarity
                    ];
                    chart.update();
                }
            };

            const resetValues = () => {
                Object.keys(defaults).forEach(key => {
                    const el = inputs[key];
                    if (!el) return;
                    if (el.type === 'checkbox') {
                        el.checked = defaults[key];
                    } else if (el.tagName === 'SELECT') {
                        el.value = defaults[key];
                    } else {
                        el.value = defaults[key];
                    }
                });
                updateCalculations();
            };

            // Event Listeners
            Object.values(inputs).forEach(input => {
                if (input) {
                    input.addEventListener('input', updateCalculations);
                }
            });

            if (resetButton) {
                resetButton.addEventListener('click', resetValues);
            }

            // Initialize on load
            resetValues();

        })();
    </script>
</body>
</html>
