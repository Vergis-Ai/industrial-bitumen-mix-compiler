<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PMB Bitumen Mix Chart</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f3f4f6;
    }
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input[type="number"] {
      -moz-appearance: textfield;
    }
  </style>
</head>
<body class="bg-slate-100 flex flex-col items-center justify-center p-6">
  <div class="bg-white rounded-3xl shadow-xl p-8 max-w-5xl w-full">
    <h1 class="text-3xl font-bold text-center mb-4">PMB Bitumen Mix Chart</h1>

    <!-- Inputs -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
      <div>
        <label for="c170Bitumen" class="block font-medium mb-1">C170 Bitumen (%)</label>
        <input type="number" id="c170Bitumen" value="70" step="0.01" min="0" max="100" class="w-full border p-2 rounded" />
      </div>
      <div>
        <label for="sbs" class="block font-medium mb-1">LG411 Radial (%)</label>
        <input type="number" id="sbs" value="15" step="0.01" min="0" max="100" class="w-full border p-2 rounded" />
      </div>
      <div>
        <label for="ha32CombiningOil" class="block font-medium mb-1">Ha32 Combining Oil (%)</label>
        <input type="number" id="ha32CombiningOil" value="10" step="0.01" min="0" max="100" class="w-full border p-2 rounded" />
      </div>
      <div>
        <label for="bitlinker" class="block font-medium mb-1">BITLINKER-S6F (%)</label>
        <input type="number" id="bitlinker" value="5" step="0.01" min="0" max="100" class="w-full border p-2 rounded" />
      </div>
    </div>

    <!-- Totals -->
    <div class="text-center mb-6">
      <p id="totalPercentage" class="text-xl font-bold">Total: 100%</p>
      <p id="remaining" class="text-gray-600">Remaining: 0%</p>
      <p id="normalizationWarning" class="text-yellow-600 hidden">Note: Values are normalized to 100% total.</p>
    </div>

    <!-- Chart -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div class="bg-white p-4 rounded-xl shadow">
        <canvas id="qualityChart" height="300"></canvas>
      </div>
      <div>
        <h2 class="text-xl font-semibold mb-4">Mix Qualities</h2>
        <div id="qualitiesList" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
      </div>
    </div>

    <!-- Reset Button -->
    <div class="text-center mt-8">
      <button id="resetButton" class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded">Reset to Default</button>
    </div>
  </div>

  <script>
    const components = {
      c170Bitumen: {
        name: 'C170 Bitumen',
        qualities: {
          Adhesion: 0.5,
          Durability: 0.6,
          Flexibility: 0.3,
          TemperatureResistance: 0.4,
          AgingResistance: 0.5,
          SettingTime: 0.8,
          Viscosity: 0.7
        },
        defaultValue: 70
      },
      sbs: {
        name: 'LG411 Radial',
        qualities: {
          Adhesion: 0.8,
          Durability: 0.9,
          Flexibility: 1.0,
          TemperatureResistance: 0.9,
          AgingResistance: 0.9,
          SettingTime: 0.6,
          Viscosity: 0.9
        },
        defaultValue: 15
      },
      ha32CombiningOil: {
        name: 'Ha32 Combining Oil',
        qualities: {
          Adhesion: 0.8,
          Durability: 0.3,
          Flexibility: 0.7,
          TemperatureResistance: 0.5,
          AgingResistance: 0.7,
          SettingTime: 1.0,
          Viscosity: 0.2
        },
        defaultValue: 10
      },
      bitlinker: {
        name: 'BITLINKER-S6F',
        qualities: {
          Adhesion: 0.6,
          Durability: 0.8,
          Flexibility: 0.2,
          TemperatureResistance: 0.9,
          AgingResistance: 0.9,
          SettingTime: 0.3,
          Viscosity: 0.8
        },
        defaultValue: 5
      }
    };

    const inputIds = Object.keys(components);
    let chart;

    function calculateQualities() {
      const final = {};
      const keys = Object.keys(components[inputIds[0]].qualities);
      keys.forEach(k => final[k] = 0);
      let total = 0;

      inputIds.forEach(id => {
        const val = parseFloat(document.getElementById(id).value) || 0;
        total += val;
      });

      inputIds.forEach(id => {
        const val = parseFloat(document.getElementById(id).value) || 0;
        const comp = components[id];
        for (const q in comp.qualities) {
          final[q] += (comp.qualities[q] * val / 100);
        }
      });

      const scale = total > 0 ? 100 / total : 0;
      const result = {};
      for (const q in final) {
        result[q] = Math.round(final[q] * scale * 100) / 100;
      }

      return { qualities: result, total };
    }

    function updateQualitiesList(qualities) {
      const container = document.getElementById('qualitiesList');
      container.innerHTML = '';

      for (const q in qualities) {
        const div = document.createElement('div');
        div.className = 'bg-gray-100 p-3 rounded shadow flex justify-between items-center';
        div.innerHTML = `
          <span class="text-gray-700">${q.replace(/([A-Z])/g, ' $1').trim()}</span>
          <span class="font-bold text-indigo-600">${qualities[q].toFixed(2)}%</span>
        `;
        container.appendChild(div);
      }
    }

    function updateUI() {
      const { qualities, total } = calculateQualities();

      // Update chart
      chart.data.datasets[0].data = Object.values(qualities);
      chart.update();

      // Update total/remaining
      document.getElementById('totalPercentage').textContent = `Total: ${total.toFixed(2)}%`;
      const remaining = 100 - total;
      const remEl = document.getElementById('remaining');
      remEl.textContent = `Remaining: ${remaining.toFixed(2)}%`;

      if (remaining === 0) {
        remEl.classList.remove('text-red-500');
        remEl.classList.add('text-green-600');
        document.getElementById('normalizationWarning').classList.add('hidden');
      } else {
        remEl.classList.remove('text-green-600');
        remEl.classList.add('text-red-500');
        document.getElementById('normalizationWarning').classList.remove('hidden');
      }

      updateQualitiesList(qualities);
    }

    function resetInputs() {
      inputIds.forEach(id => {
        document.getElementById(id).value = components[id].defaultValue.toFixed(2);
      });
      updateUI();
    }

    function debounce(func, wait) {
      let timeout;
      return function(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
      };
    }

    window.onload = () => {
      const ctx = document.getElementById('qualityChart').getContext('2d');
      chart = new Chart(ctx, {
        type: 'radar',
        data: {
          labels: Object.keys(components.c170Bitumen.qualities).map(q => q.replace(/([A-Z])/g, ' $1').trim()),
          datasets: [{
            label: 'Mix Qualities',
            data: [],
            backgroundColor: 'rgba(99, 102, 241, 0.4)',
            borderColor: 'rgb(99, 102, 241)',
            pointBackgroundColor: 'rgb(99, 102, 241)'
          }]
        },
        options: {
          responsive: true,
          scales: {
            r: {
              suggestedMin: 0,
              suggestedMax: 1,
              ticks: { stepSize: 0.2 }
            }
          }
        }
      });

      inputIds.forEach(id => {
        const input = document.getElementById(id);
        input.addEventListener('input', debounce(updateUI, 150));
      });

      document.getElementById('resetButton').addEventListener('click', resetInputs);

      resetInputs(); // Load default
    };
  </script>
</body>
</html>
