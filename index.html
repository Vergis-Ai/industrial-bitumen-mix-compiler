<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PMB Bitumen Mix Chart</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f3f4f6;
    }
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input[type="number"] {
      -moz-appearance: textfield;
    }
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      border: 0;
    }
  </style>
</head>
<body class="bg-slate-100 flex flex-col items-center justify-center p-6">
  <div class="bg-white rounded-3xl shadow-xl p-8 max-w-4xl w-full">
    <h1 class="text-3xl font-bold text-center mb-4">PMB Bitumen Mix Chart</h1>

    <!-- Inputs -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
      <div>
        <label for="c170Bitumen" class="block font-medium mb-1">C170 Bitumen (%)</label>
        <input type="number" id="c170Bitumen" value="70" step="0.01" min="0" max="100" class="w-full border p-2 rounded" />
      </div>
      <div>
        <label for="sbs" class="block font-medium mb-1">LG411 Radial (%)</label>
        <input type="number" id="sbs" value="15" step="0.01" min="0" max="100" class="w-full border p-2 rounded" />
      </div>
      <div>
        <label for="ha32CombiningOil" class="block font-medium mb-1">Ha32 Combining Oil (%)</label>
        <input type="number" id="ha32CombiningOil" value="10" step="0.01" min="0" max="100" class="w-full border p-2 rounded" />
      </div>
      <div>
        <label for="bitlinker" class="block font-medium mb-1">Ravasol™ BITLINKER-S6F (%)</label>
        <input type="number" id="bitlinker" value="5" step="0.01" min="0" max="100" class="w-full border p-2 rounded" />
      </div>
    </div>

    <!-- Total -->
    <div class="text-center mb-6">
      <p id="totalPercentage" class="text-xl font-bold">Total: 100%</p>
      <p id="remaining" class="text-gray-600">Remaining: 0%</p>
      <p id="normalizationWarning" class="text-yellow-600 hidden">Note: Values are normalized to 100% total.</p>
    </div>

    <!-- Chart -->
    <div class="mb-6">
      <canvas id="qualityChart" height="300"></canvas>
    </div>

    <!-- Reset Button -->
    <div class="text-center">
      <button id="resetButton" class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded">Reset to Default</button>
    </div>
  </div>

  <script>
    const components = {
      c170Bitumen: {
        name: 'C170 Bitumen',
        qualities: { Adhesion: 0.5, Durability: 0.6, Flexibility: 0.3, TemperatureResistance: 0.4, AgingResistance: 0.5, SettingTime: 0.8, Viscosity: 0.7 },
        defaultValue: 70
      },
      sbs: {
        name: 'LG411 Radial',
        qualities: { Adhesion: 0.8, Durability: 0.9, Flexibility: 1.0, TemperatureResistance: 0.9, AgingResistance: 0.9, SettingTime: 0.6, Viscosity: 0.9 },
        defaultValue: 15
      },
      ha32CombiningOil: {
        name: 'Ha32 Combining Oil',
        qualities: { Adhesion: 0.8, Durability: 0.3, Flexibility: 0.7, TemperatureResistance: 0.5, AgingResistance: 0.7, SettingTime: 1.0, Viscosity: 0.2 },
        defaultValue: 10
      },
      bitlinker: {
        name: 'Ravasol™ BITLINKER-S6F',
        qualities: { Adhesion: 0.6, Durability: 0.8, Flexibility: 0.2, TemperatureResistance: 0.9, AgingResistance: 0.9, SettingTime: 0.3, Viscosity: 0.8 },
        defaultValue: 5
      }
    };

    const inputIds = ['c170Bitumen', 'sbs', 'ha32CombiningOil', 'bitlinker'];
    let chart;

    function debounce(func, delay) {
      let timer;
      return function(...args) {
        clearTimeout(timer);
        timer = setTimeout(() => func.apply(this, args), delay);
      };
    }

    function calculateQualities() {
      const final = {};
      const keys = Object.keys(components[inputIds[0]].qualities);
      keys.forEach(k => final[k] = 0);
      let total = 0;

      inputIds.forEach(id => {
        const val = parseFloat(document.getElementById(id).value) || 0;
        total += val;
      });

      inputIds.forEach(id => {
        const val = parseFloat(document.getElementById(id).value) || 0;
        const comp = components[id];
        for (const q in comp.qualities) {
          final[q] += (comp.qualities[q] * val / 100);
        }
      });

      const scale = total > 0 ? 100 / total : 0;
      const result = {};
      for (const q in final) {
        result[q] = Math.round(final[q] * scale * 100) / 100;
      }

      return { qualities: result, total };
    }

    function updateChart() {
      const { qualities } = calculateQualities();
      chart.data.datasets[0].data = Object.values(qualities);
      chart.update();
    }

    function updateUI() {
      const { total } = calculateQualities();
      document.getElementById('totalPercentage').textContent = `Total: ${total.toFixed(2)}%`;
      const remaining = 100 - total;
      const remainingEl = document.getElementById('remaining');
      remainingEl.textContent = `Remaining: ${remaining.toFixed(2)}%`;

      if (remaining === 0) {
        remainingEl.classList.remove('text-red-500');
        remainingEl.classList.add('text-green-600');
        document.getElementById('normalizationWarning').classList.add('hidden');
      } else {
        remainingEl.classList.remove('text-green-600');
        remainingEl.classList.add('text-red-500');
        document.getElementById('normalizationWarning').classList.remove('hidden');
      }

      updateChart();
    }

    function resetInputs() {
      inputIds.forEach(id => {
        document.getElementById(id).value = components[id].defaultValue.toFixed(2);
      });
      updateUI();
    }

    window.onload = function () {
      const ctx = document.getElementById('qualityChart').getContext('2d');
      const qualities = Object.keys(components.c170Bitumen.qualities);

      chart = new Chart(ctx, {
        type: 'radar',
        data: {
          labels: qualities.map(q => q.replace(/([A-Z])/g, ' $1').trim()),
          datasets: [{
            label: 'Mix Qualities',
            data: qualities.map(() => 0),
            backgroundColor: 'rgba(99, 102, 241, 0.2)',
            borderColor: 'rgba(99, 102, 241, 1)',
            borderWidth: 2,
            pointBackgroundColor: 'rgba(99, 102, 241, 1)'
          }]
        },
        options: {
          responsive: true,
          scales: {
            r: {
              suggestedMin: 0,
              suggestedMax: 1,
              ticks: { stepSize: 0.2 }
            }
          }
        }
      });

      // Setup listeners
      inputIds.forEach(id => {
        const input = document.getElementById(id);

        input.addEventListener('input', debounce(updateUI, 150));

        input.addEventListener('blur', () => {
          const val = parseFloat(input.value);
          if (!isNaN(val)) input.value = val.toFixed(2);
        });
      });

      document.getElementById('resetButton').addEventListener('click', resetInputs);

      resetInputs();
    };
  </script>
</body>
</html>
